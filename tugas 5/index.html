<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistem Absensi SDN Pagar Dewa</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      background-color: #f7f9fc;
      padding: 20px;
      font-family: "Poppins", sans-serif;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #2a4d69;
    }
    table {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
      text-align: center;
      font-size: 13px;
    }
    .header-info {
      margin-bottom: 20px;
    }
    .btn-export {
      background-color: #2a4d69;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Absensi Bulanan - SDN Pagar Dewa (Kelas IV/1)</h2>
    <div class="header-info">
      <strong>Sekolah:</strong> SDN Pagar Dewa<br>
      <strong>Kelas/Semester:</strong> IV / 1<br>
      <strong>Bulan:</strong> Oktober<br>
      <strong>Tahun Pelajaran:</strong> 2025/2026<br><br>
      <button class="btn btn-export" onclick="exportExcel()">Download Excel</button>
    </div>

    <div class="table-responsive">
      <table id="attendanceTable" class="table table-bordered table-striped align-middle">
        <thead class="table-primary">
          <tr>
            <th>No</th>
            <th>Nama</th>
            <!-- Buat tanggal 1-31 -->
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <h4 class="mt-4">Rekap Total</h4>
    <table id="summaryTable" class="table table-bordered table-sm">
      <thead class="table-secondary">
        <tr>
          <th>No</th>
          <th>Nama</th>
          <th>Hadir (H)</th>
          <th>Sakit (S)</th>
          <th>Izin (I)</th>
          <th>Alpha (A)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    // --- Data awal siswa ---
    const students = [
      "AHMAD AZZAM ANULLAH","FADLUN MUZAKI","KHANZA NUR RAHMA","KI MAURA BILIQS F",
      "LATIFATUL BAHIRIAH","MUTIARA DEWI SAPUTRI","NATASYA ARDANI","NITIA PUSPITA",
      "OKTAVIA FAJAR R","SELY SETIYAWATI","UMI PERMATA HATI","ZAINUNA APRILIYA K"
    ];
    const days = Array.from({ length: 31 }, (_, i) => i + 1);

    const tableHead = document.querySelector("#attendanceTable thead tr");
    const tableBody = document.querySelector("#attendanceTable tbody");
    const summaryBody = document.querySelector("#summaryTable tbody");

    // Tambahkan kolom tanggal
    days.forEach(day => {
      const th = document.createElement("th");
      th.textContent = day;
      tableHead.appendChild(th);
    });

    // Buat baris data
    students.forEach((name, idx) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${idx + 1}</td><td>${name}</td>`;
      days.forEach(day => {
        const td = document.createElement("td");
        const select = document.createElement("select");
        ["", "H", "S", "I", "A"].forEach(opt => {
          const option = document.createElement("option");
          option.value = opt;
          option.textContent = opt;
          select.appendChild(option);
        });
        select.addEventListener("change", updateSummary);
        td.appendChild(select);
        tr.appendChild(td);
      });
      tableBody.appendChild(tr);
    });

    // Hitung total hadir/sakit/izin/alpha
    function updateSummary() {
      summaryBody.innerHTML = "";
      students.forEach((name, idx) => {
        const row = tableBody.rows[idx];
        const values = Array.from(row.querySelectorAll("select")).map(s => s.value);
        const count = {
          H: values.filter(v => v === "H").length,
          S: values.filter(v => v === "S").length,
          I: values.filter(v => v === "I").length,
          A: values.filter(v => v === "A").length
        };
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${idx + 1}</td><td>${name}</td>
          <td>${count.H}</td><td>${count.S}</td><td>${count.I}</td><td>${count.A}</td>`;
        summaryBody.appendChild(tr);
      });
    }

    // Ekspor ke Excel
    function exportExcel() {
      updateSummary();
      const wb = XLSX.utils.book_new();
      const attendanceData = [];
      const header = ["No", "Nama", ...days.map(d => d.toString())];
      attendanceData.push(header);

      students.forEach((name, idx) => {
        const row = [idx + 1, name];
        Array.from(tableBody.rows[idx].querySelectorAll("select")).forEach(sel => {
          row.push(sel.value);
        });
        attendanceData.push(row);
      });

      const ws1 = XLSX.utils.aoa_to_sheet(attendanceData);
      XLSX.utils.book_append_sheet(wb, ws1, "Absensi");

      // Summary sheet
      const summaryData = [["No","Nama","Hadir (H)","Sakit (S)","Izin (I)","Alpha (A)"]];
      students.forEach((name, idx) => {
        const row = summaryBody.rows[idx];
        if (row) {
          const vals = Array.from(row.cells).map(td => td.innerText);
          summaryData.push(vals);
        }
      });
      const ws2 = XLSX.utils.aoa_to_sheet(summaryData);
      XLSX.utils.book_append_sheet(wb, ws2, "Rekap");

      XLSX.writeFile(wb, "Absensi_SDN_Pagar_Dewa.xlsx");
    }
  </script>
</body>
</html>
